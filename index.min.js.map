{"version":3,"file":"index.min.js","sources":["src/index.js"],"sourcesContent":["const isFun = value => typeof value === 'function';\nconst isObj = value => Object.prototype.toString.call(value) === '[object Object]';\nconst isNum = value => typeof value === 'number' && !Number.isNaN(value) && Number.isFinite(value);\n\n/**\n * 一个倒计时专用工具类，可用来创建倒计时对象\n * @param {number} time 倒计时时间\n * @param {Object} options 倒计时参数\n * @param {Function} tickCallback 倒计时步进回调\n *\n * @example\n * import CountDown from 'time-cd'; \n * // In NodeJS\n * // const CountDown = require('time-cd');\n *\n * // 1、创建并自动开启一个24小时的倒计时\n * new CountDown(854e5, cd => console.log(cd.hhmmss));\n *\n * // 2、创建并自动开启一个60s的倒计时\n * new CountDown(60000, { cdType: 's' }, cd => console.log(cd.s));\n *\n * // 3、创建一个60s倒计时，并设置开始和结束\n * const countdown = new CountDown(60000, { autoStart: false }, () => {\n *   console.log(countdown);\n * });\n * countdown.start();\n * // A moment later\n * countdown.stop();\n * \n * // 4、创建一个倒计时，自定义时间、处理函数和开启倒计时\n * const countdown = new CountDown();\n * countdown.onTick = cd => console.log(countdown)}\n * countdown.start();\n */\nfunction CountDown(time, options, tickCallback) {\n  if (isFun(time)) {\n    tickCallback = time;\n  } else if (isFun(options)) {\n    tickCallback = options;\n  }\n  options = isObj(options) ? options : {};\n  this.options = options;\n  // 初始时间\n  this.initTime = isNum(time) ? time : null;\n  // 剩余时间\n  this.restTime = this.time;\n  // 定时间隔\n  this.interval = isNum(options.interval) ? options.interval : 1000;\n  // 是否自动启动倒计时\n  this.autoStart = options.autoStart !== false;\n  // 倒计时类型，'d': 计算到天；'h': 计算到小时；'m': 计算到分钟；'s': 计算到秒；默认：'h'\n  this.cdType = ['d', 'h', 'm', 's'].indexOf(options.cdType) > -1 ? options.cdType : 'h';\n  this.running = false;\n  this.destoryed = false;\n  this.completed = false;\n  this.tickTimes = 0;\n  this.restDays = null;\n  this.restHours = null;\n  this.restMinuts = null;\n  this.restSeconds = null;\n  this.d = '-';\n  this.h = '-';\n  this.m = '-';\n  this.s = '-';\n  this.dd = '--';\n  this.hh = '--';\n  this.mm = '--';\n  this.ss = '--';\n  this.ms = '-:-';\n  this.hms = '-:-:-';\n  this.mmss = '--:--';\n  this.hhmmss = '--:--:--';\n  this.timerId = null;\n  /**\n   * 开始倒计时\n   */\n  this.start = function () {\n    if (this.destoryed) return;\n    this.running = true;\n    if (this.interval >= 0 && this.restTime >= this.interval) {\n      this.timerId = setInterval(() => this.tick(), this.interval);\n    } else {\n      this.setComplete();\n    }\n  };\n  /**\n   * 暂停倒计时\n   */\n  this.stop = function () {\n    clearInterval(this.timerId);\n    this.running = false;\n  };\n  /**\n   * 销毁倒计时\n   */\n  this.destory = function () {\n    clearInterval(this.timerId);\n    this.running = false;\n    this.destoryed = true;\n  };\n  /**\n   * 定时步进\n   */\n  this.tick = function () {\n    this.tickTimes++;\n    if (this.restTime > this.interval) {\n      this.restTime -= this.interval;\n      this.setValue();\n    } else {\n      this.restTime = 0;\n      this.setValue();\n      this.setComplete();\n    }\n    if (isFun(this.onTick)) this.onTick(this);\n    if (isFun(tickCallback)) tickCallback(this);\n  };\n  /**\n   * 设置定时器的值\n   */\n  this.setValue = function () {\n    if (!this.restTime || this.restTime < 0) {\n      this.restTime = 0;\n    }\n    this.restSeconds = Math.floor(this.restTime / 1000);\n    this.restDays = Math.floor(this.restTime / 864e5);\n    this.restHours = Math.floor(this.restSeconds / 3600);\n    this.restMinuts = Math.floor(this.restSeconds / 60);\n    if (this.cdType === 'd') {\n      const restSeconds = Math.floor((this.restTime % 864e5) / 1000);\n      this.d = this.restDays;\n      this.h = Math.floor(restSeconds / 3600);\n      this.m = Math.floor((restSeconds % 3600) / 60);\n      this.s = Math.floor(restSeconds % 60);\n    } else if (this.cdType === 'h') {\n      this.d = 0;\n      this.h = this.restHours;\n      this.m = Math.floor((this.restSeconds % 3600) / 60);\n      this.s = Math.floor(this.restSeconds % 60);\n    } else if (this.cdType === 'm') {\n      this.d = 0;\n      this.h = 0;\n      this.m = this.restMinuts;\n      this.s = Math.floor(this.restSeconds % 60);\n    } else if (this.cdType === 's') {\n      this.d = 0;\n      this.h = 0;\n      this.m = 0;\n      this.s = this.restSeconds;\n    }\n    const dhms = 'dhms';\n    const tpls = dhms.substr(dhms.indexOf(this.cdType));\n    tpls.split('').forEach(item => {\n      const itemStr = String(this[item]);\n      this[item + item] = itemStr.length < 2 ? `00${itemStr}`.substr(-2) : itemStr;\n    });\n    this.ms = `${this.m}:${this.s}`;\n    this.mmss = `${this.mm}:${this.ss}`;\n    this.hms = `${this.h}:${this.m}:${this.s}`;\n    this.hhmmss = `${this.hh}:${this.mm}:${this.ss}`;\n    ['dd', 'hh', 'mm', 'ss', 'ms', 'ms', 'hms', 'mmss', 'hhmmss'].forEach(item => {\n      this[item] = this[item].replace(/-/g, '0');\n    });\n  };\n  /**\n   * 定时器结束\n   */\n  this.setComplete = function () {\n    clearInterval(this.timerId);\n    this.running = false;\n    this.completed = true;\n  };\n  /**\n   * 判断是否自动开启\n   */\n  if (isNum(this.time)) {\n    this.setValue();\n    if (this.autoStart) {\n      setTimeout(() => this.start());\n    }\n  }\n}\n/**\n * 初始时间为null时，可以再次设置开始时间\n */\nObject.defineProperty(CountDown.prototype, 'time', {\n  get: function get() {\n    return this.initTime;\n  },\n  set: function set(val) {\n    if (isNum(val)) {\n      this.initTime = val;\n      this.restTime = val;\n    }\n  },\n});\nmodule.exports = CountDown;\n"],"names":["isFun","value","isNum","Number","isNaN","isFinite","CountDown","time","options","tickCallback","Object","prototype","toString","call","initTime","restTime","this","interval","autoStart","cdType","indexOf","running","destoryed","completed","tickTimes","restDays","restHours","restMinuts","restSeconds","d","h","m","s","dd","hh","mm","ss","ms","hms","mmss","hhmmss","timerId","start","setInterval","_this","tick","setComplete","stop","clearInterval","destory","setValue","onTick","Math","floor","dhms","substr","split","forEach","item","itemStr","String","_this2","length","replace","setTimeout","_this3","defineProperty","get","set","val","module","exports"],"mappings":"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"}